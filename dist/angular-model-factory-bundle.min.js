/**
 * modelFactory makes working with RESTful APIs in AngularJS easy
 * @version v1.0.5 - 2016-08-24
 * @link http://swimlane.github.io/angular-model-factory/
 * @author Austin McDaniel <amcdaniel2@gmail.com>, Juri Strumpflohner <juri.strumpflohner@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a){"use strict";function b(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}function c(a,b){Object.defineProperty(this,"kind",{value:a,enumerable:!0}),b&&b.length&&Object.defineProperty(this,"path",{value:b,enumerable:!0})}function d(a,b,c){d.super_.call(this,"E",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0}),Object.defineProperty(this,"rhs",{value:c,enumerable:!0})}function e(a,b){e.super_.call(this,"N",a),Object.defineProperty(this,"rhs",{value:b,enumerable:!0})}function f(a,b){f.super_.call(this,"D",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0})}function g(a,b,c){g.super_.call(this,"A",a),Object.defineProperty(this,"index",{value:b,enumerable:!0}),Object.defineProperty(this,"item",{value:c,enumerable:!0})}function h(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=b<0?a.length+b:b,a.push.apply(a,d),a}function i(b,c,j,k,l,m,n){l=l||[];var o=l.slice(0);if("undefined"!=typeof m){if(k&&k(o,m))return;o.push(m)}var p=typeof b,q=typeof c;if("undefined"===p)"undefined"!==q&&j(new e(o,c));else if("undefined"===q)j(new f(o,b));else if(p!==q)j(new d(o,b,c));else if(b instanceof Date&&c instanceof Date&&b-c!==0)j(new d(o,b,c));else if("object"===p&&null!==b&&null!==c){if(n=n||[],n.indexOf(b)<0){if(n.push(b),Array.isArray(b)){var r;b.length;for(r=0;r<b.length;r++)r>=c.length?j(new g(o,r,new f(a,b[r]))):i(b[r],c[r],j,k,o,r,n);for(;r<c.length;)j(new g(o,r,new e(a,c[r++])))}else{var s=Object.keys(b),t=Object.keys(c);s.forEach(function(d,e){var f=t.indexOf(d);f>=0?(i(b[d],c[d],j,k,o,d,n),t=h(t,f)):i(b[d],a,j,k,o,d,n)}),t.forEach(function(b){i(a,c[b],j,k,o,b,n)})}n.length=n.length-1}}else b!==c&&("number"===p&&isNaN(b)&&isNaN(c)||j(new d(o,b,c)))}function j(b,c,d,e){return e=e||[],i(b,c,function(a){a&&e.push(a)},d),e.length?e:a}function k(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":k(e[c.path[d]],c.index,c.item);break;case"D":delete e[c.path[d]];break;case"E":case"N":e[c.path[d]]=c.rhs}}else switch(c.kind){case"A":k(a[b],c.index,c.item);break;case"D":a=h(a,b);break;case"E":case"N":a[b]=c.rhs}return a}function l(a,b,c){if(a&&b&&c&&c.kind){for(var d=a,e=-1,f=c.path.length-1;++e<f;)"undefined"==typeof d[c.path[e]]&&(d[c.path[e]]="number"==typeof c.path[e]?new Array:{}),d=d[c.path[e]];switch(c.kind){case"A":k(d[c.path[e]],c.index,c.item);break;case"D":delete d[c.path[e]];break;case"E":case"N":d[c.path[e]]=c.rhs}}}function m(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":m(e[c.path[d]],c.index,c.item);break;case"D":e[c.path[d]]=c.lhs;break;case"E":e[c.path[d]]=c.lhs;break;case"N":delete e[c.path[d]]}}else switch(c.kind){case"A":m(a[b],c.index,c.item);break;case"D":a[b]=c.lhs;break;case"E":a[b]=c.lhs;break;case"N":a=h(a,b)}return a}function n(a,b,c){if(a&&b&&c&&c.kind){var d,e,f=a;for(e=c.path.length-1,d=0;d<e;d++)"undefined"==typeof f[c.path[d]]&&(f[c.path[d]]={}),f=f[c.path[d]];switch(c.kind){case"A":m(f[c.path[d]],c.index,c.item);break;case"D":f[c.path[d]]=c.lhs;break;case"E":f[c.path[d]]=c.lhs;break;case"N":delete f[c.path[d]]}}}function o(a,b,c){if(a&&b){var d=function(d){c&&!c(a,b,d)||l(a,b,d)};i(a,b,d)}}var p,q,r=[];p="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},q=p.DeepDiff,q&&r.push(function(){"undefined"!=typeof q&&p.DeepDiff===j&&(p.DeepDiff=q,q=a)}),b(d,c),b(e,c),b(f,c),b(g,c),Object.defineProperties(j,{diff:{value:j,enumerable:!0},observableDiff:{value:i,enumerable:!0},applyDiff:{value:o,enumerable:!0},applyChange:{value:l,enumerable:!0},revertChange:{value:n,enumerable:!0},isConflict:{get:function(){return"undefined"!=typeof q},enumerable:!0},noConflict:{value:function(){return r&&(r.forEach(function(a){a()}),r=null),j},enumerable:!0}}),"undefined"!=typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=j:p.DeepDiff=j}(),function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.UriTemplate=b()}(this,function(){function a(a){return encodeURI(a).replace(/%25[0-9][0-9]/g,function(a){return"%"+a.substring(3)})}function b(b){var c="";d[b.charAt(0)]&&(c=b.charAt(0),b=b.substring(1));var f="",g="",h=!0,i=!1,j=!1;"+"==c?h=!1:"."==c?(g=".",f="."):"/"==c?(g="/",f="/"):"#"==c?(g="#",h=!1):";"==c?(g=";",f=";",i=!0,j=!0):"?"==c?(g="?",f="&",i=!0):"&"==c&&(g="&",f="&",i=!0);for(var k=[],l=b.split(","),m=[],n={},o=0;o<l.length;o++){var p=l[o],q=null;if(p.indexOf(":")!=-1){var r=p.split(":");p=r[0],q=parseInt(r[1])}for(var s={};e[p.charAt(p.length-1)];)s[p.charAt(p.length-1)]=!0,p=p.substring(0,p.length-1);var t={truncate:q,name:p,suffices:s};m.push(t),n[p]=t,k.push(p)}var u=function(b){for(var c="",d=0,e=0;e<m.length;e++){var k=m[e],l=b(k.name);if(null==l||Array.isArray(l)&&0==l.length||"object"==typeof l&&0==Object.keys(l).length)d++;else if(c+=e==d?g:f||",",Array.isArray(l)){i&&(c+=k.name+"=");for(var n=0;n<l.length;n++)n>0&&(c+=k.suffices["*"]?f||",":",",k.suffices["*"]&&i&&(c+=k.name+"=")),c+=h?encodeURIComponent(l[n]).replace(/!/g,"%21"):a(l[n])}else if("object"==typeof l){i&&!k.suffices["*"]&&(c+=k.name+"=");var o=!0;for(var p in l)o||(c+=k.suffices["*"]?f||",":","),o=!1,c+=h?encodeURIComponent(p).replace(/!/g,"%21"):a(p),c+=k.suffices["*"]?"=":",",c+=h?encodeURIComponent(l[p]).replace(/!/g,"%21"):a(l[p])}else i&&(c+=k.name,j&&""==l||(c+="=")),null!=k.truncate&&(l=l.substring(0,k.truncate)),c+=h?encodeURIComponent(l).replace(/!/g,"%21"):a(l)}return c},v=function(a,b){if(g){if(a.substring(0,g.length)!=g)return null;a=a.substring(g.length)}if(1==m.length&&m[0].suffices["*"]){for(var c=m[0],d=c.name,e=c.suffices["*"]?a.split(f||","):[a],j=h&&a.indexOf("=")!=-1,k=1;k<e.length;k++){var a=e[k];j&&a.indexOf("=")==-1&&(e[k-1]+=(f||",")+a,e.splice(k,1),k--)}for(var k=0;k<e.length;k++){var a=e[k];h&&a.indexOf("=")!=-1&&(j=!0);for(var l=a.split(","),o=0;o<l.length;o++)h&&(l[o]=decodeURIComponent(l[o]));1==l.length?e[k]=l[0]:e[k]=l}if(i||j){for(var p=b[d]||{},o=0;o<e.length;o++){var q=a;if(!i||q){if("string"==typeof e[o]){var a=e[o],r=a.split("=",1)[0],a=a.substring(r.length+1);q=a}else{var a=e[o][0],r=a.split("=",1)[0],a=a.substring(r.length+1);e[o][0]=a,q=e[o]}void 0!==p[r]?Array.isArray(p[r])?p[r].push(q):p[r]=[p[r],q]:p[r]=q}}1==Object.keys(p).length&&void 0!==p[d]?b[d]=p[d]:b[d]=p}else void 0!==b[d]?Array.isArray(b[d])?b[d]=b[d].concat(e):b[d]=[b[d]].concat(e):1!=e.length||c.suffices["*"]?b[d]=e:b[d]=e[0]}else{for(var e=1==m.length?[a]:a.split(f||","),s={},k=0;k<e.length;k++){for(var t=0;t<m.length-1&&t<k&&!m[t].suffices["*"];t++);if(t!=k){for(var u=m.length-1;u>0&&m.length-u<e.length-k&&!m[u].suffices["*"];u--);m.length-u!=e.length-k?s[k]=t:s[k]=u}else s[k]=k}for(var k=0;k<e.length;k++){var a=e[k];if(a||!i){var l=a.split(","),j=!1;if(i){var a=l[0],d=a.split("=",1)[0],a=a.substring(d.length+1);l[0]=a;var c=n[d]||m[0]}else var c=m[s[k]],d=c.name;for(var o=0;o<l.length;o++)h&&(l[o]=decodeURIComponent(l[o]));(i||c.suffices["*"])&&void 0!==b[d]?Array.isArray(b[d])?b[d]=b[d].concat(l):b[d]=[b[d]].concat(l):1!=l.length||c.suffices["*"]?b[d]=l:b[d]=l[0]}}}};return u.varNames=k,{prefix:g,substitution:u,unSubstitution:v}}function c(a){if(!(this instanceof c))return new c(a);for(var d=a.split("{"),e=[d.shift()],f=[],g=[],h=[],i=[];d.length>0;){var j=d.shift(),k=j.split("}")[0],l=j.substring(k.length+1),m=b(k);g.push(m.substitution),h.push(m.unSubstitution),f.push(m.prefix),e.push(l),i=i.concat(m.substitution.varNames)}this.fill=function(a){if(a&&"function"!=typeof a){var b=a;a=function(a){return b[a]}}for(var c=e[0],d=0;d<g.length;d++){var f=g[d];c+=f(a),c+=e[d+1]}return c},this.fromUri=function(a){for(var b={},c=0;c<e.length;c++){var d=e[c];if(a.substring(0,d.length)!==d)return;if(a=a.substring(d.length),c>=e.length-1){if(""==a)break;return}for(var g=e[c+1],i=c;;){if(i==e.length-2){var j=a.substring(a.length-g.length);if(j!==g)return;var k=a.substring(0,a.length-g.length);a=j}else if(g){var l=a.indexOf(g),k=a.substring(0,l);a=a.substring(l)}else if(f[i+1]){var l=a.indexOf(f[i+1]);l===-1&&(l=a.length);var k=a.substring(0,l);a=a.substring(l)}else{if(e.length>i+2){i++,g=e[i+1];continue}var k=a;a=""}break}h[c](k,b)}return b},this.varNames=i,this.template=a}var d={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},e={"*":!0};return c.prototype={toString:function(){return this.template},fillFromObject:function(a){return this.fill(a)}},c}),function(a,b){"function"==typeof define&&define.amd?define(["angular","uri-templates","deep-diff"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("angular"),require("uri-templates"),require("deep-diff")):a.ModelFactory=b(a.angular,a.UriTemplate,a.DeepDiff)}(this,function(a,b,c){var d=a.module("modelFactory",[]),e=a.isUndefined,f=a.forEach,g=a.extend,h=a.copy,i=["$$array","$save","$destroy","$pending","$rollback","$diff","$update","$commit","$copy"],j=["actions","instance","list","defaults","pk","stripTrailingSlashes","map"],k=function(b){return f(arguments,function(c){c!==b&&f(c,function(c,d){i.indexOf(d)===-1&&(b[d]?a.isArray(b[d])?b[d].concat(c.filter(function(a){var c=b[d].indexOf(a)!==-1;return c&&k(c,a),c})):a.isObject(b[d])?k(b[d],c):b[d]=c:a.isFunction(b[d])||(b[d]=c))})}),b},l=function(b,c){c=c||{},f(c,function(a,d){b.hasOwnProperty(d)||"$"===d.charAt(0)||delete c[d]});for(var d in b)b.hasOwnProperty(d)&&"$"!==d.charAt(0)&&(a.isObject(b[d])&&!a.isArray(b[d])?c[d]=l(b[d],c[d]):c[d]=b[d]);return c};return d.provider("$modelFactory",function(){var d=this;d.defaultOptions={prefix:"",pk:"id",stripTrailingSlashes:!0,defaults:{},map:{},actions:{base:{wrap:!0,beforeRequest:void 0,afterRequest:void 0,cache:!1},get:{method:"GET"},query:{method:"GET",isArray:!0},post:{method:"POST",invalidateCache:!0},update:{method:"PUT",invalidateCache:!0},delete:{method:"DELETE",invalidateCache:!0}},instance:{},list:{}},d.$get=["$rootScope","$http","$q","$log","$cacheFactory",function(m,n,o,p,q){function r(p,r){function s(a){a=a||[],a.forEach(function(b,c){null!==b&&void 0!==b&&(a[c]=x(b,a))});var b=a.push;return a.push=function(){for(var c=Array.prototype.slice.call(arguments),d=0;d<c.length;d++)c[d]=x(c[d],a);b.apply(a,c)},r.list&&g(a,r.list),a}function t(b){var d=this,e=[];b=b||{},f(r.defaults,function(a,c){void 0===b[c]&&("function"==typeof a?b[c]=h(a(b)):b[c]=h(a))}),f(r.map,function(a,c){y(a)===y(t)||y(a)===y(s)?b[c]=new a(b[c]):"function"==typeof a?b[c]=a(b[c],b):(b[c]=b[a],delete b[a])}),f(r.actions,function(a,b){"$"===b[0]&&(d[b]=function(){return t.$buildRequest(b,a,d)})}),g(d,b),g(d,h(r.instance)),d.$save=function(){var b=d[r.pk]?"update":"post",c=t[b](this);return d.$pending=!0,c.then(function(c){d.$pending=!1,c&&d.$update(c);var f="post"===b?"created":"updated";m.$broadcast(w+"-"+f,d),e.push(a.toJson(d))},function(){d.$pending=!1}),c},d.$destroy=function(){var a=t.delete(this);return d.$pending=!0,a.then(function(){d.$pending=!1;var a=d.$$array;a&&a.splice(a.indexOf(d),1),m.$broadcast(w+"-destroyed",d)},function(){d.$pending=!1}),a},d.$diff=function(b){var f=e[b||e.length-1],g=a.toJson(d);return c.diff(JSON.parse(f),JSON.parse(g),function(a,b){return"$"===b[0]})},d.$commit=function(){return e.push(a.toJson(d)),d},d.$rollback=function(a){var b=e[a||e.length-1];return d.$update(JSON.parse(b)),d},d.$update=function(a){return l(a,d),d},d.$copy=function(){var b=a.toJson(this);return new t(a.fromJson(b))},d.$commit()}var u={},v=p.split("/"),w=v[v.length-1];r=k({},h(d.defaultOptions),r);var x=function(a,b){var c=a.constructor===t?a:new t(a);return c.$$array=b,c},y=function(a){var b=a.toString();return b=b.substr("function ".length),b=b.substr(0,b.indexOf("("))},z=Math.random().toString(36).substr(2);return t.$cache=q(z),f(r.actions,function(a,b){"base"!==b&&"$"!==b[0]&&(t[b]=function(){var c=Array.prototype.slice.call(arguments);return t.$buildRequest.apply(this,[b,a].concat(c))})}),t.$buildRequest=function(b,c,d,e){var f=h(r.actions.base);g(f,h(c)),f.cache===!0&&(f.cache=t.$cache),f.method=f.method||"GET";var i=r.prefix?r.prefix+"/":"";if(f.override)i=f.url;else{if(i+=p,f.url){var j=!/^(\/|{\/)/.test(f.url);i+=j?"/"+f.url:f.url}if(i=t.$url(i,d,f.method),"get"!==b&&"post"!==b&&"update"!==b&&"delete"!==b||(i+="{/"+r.pk+"}"),"GET"===f.method&&(a.isString(d)||a.isNumber(d))){var l={};l[r.pk]=d,d=l,e&&(f.params=k({},f.params,e))}else"GET"===f.method&&a.isObject(d)&&(f.params=k({},f.params,d))}return f.url=t.$url(i,d,f.method),"delete"!==b&&"DELETE"!==f.method&&(f.data=d),t.$call(f)},t.$call=function(a){var b="POST"!==a.method,c=a.method+":"+a.url;if(b&&u[c])return u[c];var d=o.defer();return b&&(u[c]=d.promise),a.data=h(a.data),a.beforeRequest&&a.beforeRequest(a),a.data=t.$strip(a.data),n(a).then(function(b){if(a.afterRequest){var c=a.afterRequest(b.data);e(c)||(b.data=c)}a.invalidateCache&&t.$cache.removeAll(),b?a.wrap?a.isArray?d.resolve(new t.List(b.data)):d.resolve(new t(b.data)):d.resolve(b.data):d.resolve()},d.reject).finally(function(){b&&(u[c]=void 0)}),d.promise},t.$url=function(a,c,d){var e=new b(a||p).fill(function(a){var b=c[a];return b?("GET"===d&&delete c[a],b):null});return r.stripTrailingSlashes&&(e=e.replace(/\/+$/,"")||"/"),e},t.$strip=function(a){return a&&"object"==typeof a&&f(a,function(b,c){i.indexOf(c)>-1&&delete a[c]}),a},f(r,function(a,b){j.indexOf(b)===-1&&(t[b]=a)}),t.List=s,t}return r}]}),d});